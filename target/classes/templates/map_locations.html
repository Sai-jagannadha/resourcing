<!DOCTYPE html>
<html xmlns:th="https://thymleaf.org">
<head>
<meta charset="ISO-8859-1">
<title>360Resourcing</title>

<style>
#map {
	height: 80%;
	width: 50%;
}

/*
		 * Optional: Makes the sample page fill the window.
		 */
html, body {
	height: 80%;
	margin: 0;
	padding: 0;
}
</style>

</head>
<body>
	<div id="map">
	<div class="mappe" th:attr="data-mappe=${listCompany}"
			style="width: 100%; height: 100%"></div>
	</div>


<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
<!-- jsFiddle will insert css and js -->
<script th:inline="javascript">
let map;
var myMapList = new Array( $('.mappe').attr('data-mappe') );
const msg = new String(myMapList);
console.log('test')
console.log(msg)
arr=msg.split("],");
console.log(arr)



function initMap() {
const uluru = { lat: 20.5937 , lng:78.9629};
const map = new google.maps.Map(document.getElementById("map"), {
zoom: 4,
center: uluru,
});
setMarkers(map);
}



function setMarkers(map) {



const image = {
url: "https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png",



size: new google.maps.Size(20, 32),
origin: new google.maps.Point(0, 0),
anchor: new google.maps.Point(0, 32),
};
const shape = {
coords: [1, 1, 1, 20, 18, 20, 18, 1],
type: "poly",
};
console.log(arr.length)
for (let i = 0; i < arr.length-1; i++) {
const beach = arr[i]+"]";
console.log(beach)
const obj = JSON.parse(beach);
console.log('test'+i)
console.log(obj)



const marker = new google.maps.Marker({
position: { lat: parseFloat(obj[1]), lng: parseFloat(obj[2]) },
map,



shape: shape,
title: obj[0],
zIndex: parseFloat(obj[3]),
});





const contentString =
'<div id="content">' +
'<div id="siteNotice">' +
"</div>" +
'<h1 id="firstHeading" class="firstHeading">' +obj[0]+222222222
' </h1><div id="bodyContent">' +
beach +
"</div>" +
"</div>";
const infowindow = new google.maps.InfoWindow({
content: contentString,
});





marker.addListener("click", () => {
infowindow.open({
anchor: marker,
map,
shouldFocus: false,
});
});






}








}





window.initMap = initMap;
</script>



<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>




 <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBcDDJ5HtKIEsIwheIjJv8RA5Z2RtLnw0U&callback=initMap&v=weekly"
      defer
    ></script>


</body>
</html>